{"_path":"/blog/high-level-decrypting-sso-sessions-with-php","_dir":"blog","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"HighLevel: Decrypting SSO sessions with PHP | Adrian Gonzales","description":"Using PHP to decrypt the HighLevel SSO payload","excerpt":"Using PHP to decrypt the HighLevel SSO payload","headline":"HighLevel: Decrypting SSO sessions with PHP","date":"2023-11-21T12:00:00","dateUpdated":"","author":"Adrian Gonzales","authorUrl":"https://virexmachina.com/","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I'm working on an extensive custom integration with "},{"type":"element","tag":"a","props":{"href":"https://www.gohighlevel.com/","rel":["noopener","noreferer"],"target":"_blank"},"children":[{"type":"text","value":"HighLevel"}]},{"type":"text","value":", now possible because they recently built a single-sign-on process that allows web applications embedded in iFrames to validate that they are being loaded within the HL interface, as well as retrieve information about the current user and account viewing the application."}]},{"type":"element","tag":"h3","props":{"id":"the-challenge"},"children":[{"type":"text","value":"The Challenge"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This process is an interesting challenge due to security concerns and cross-domain resources loaded in iFrames."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The official documentation around this feature is very limited, mostly "},{"type":"element","tag":"a","props":{"href":"https://github.com/GoHighLevel/ghl-marketplace-app-template#sso","rel":["noopener","noreferer"],"target":"_blank"},"children":[{"type":"text","value":"this example implementation"}]},{"type":"text","value":". Thankfully, talented people are sharing their knowledge, like "},{"type":"element","tag":"a","props":{"href":"https://www.youtube.com/watch?v=3rveQDuVlR0","rel":["noopener","noreferer"],"target":"_blank"},"children":[{"type":"text","value":"Sergio Leon's video explaining the SSO process"}]},{"type":"text","value":" and "},{"type":"element","tag":"a","props":{"href":"https://seankerr.dev/posts/decrypting-highlevel-sso-session-using-python/","rel":["noopener","noreferer"],"target":"_blank"},"children":[{"type":"text","value":"Sean Kerr's blog post adapting the process to Python"}]},{"type":"text","value":". The obvious challenge was implementing the decryption logic in PHP."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"HighLevel uses "},{"type":"element","tag":"a","props":{"href":"https://github.com/brix/crypto-js","rel":["noopener","noreferer"],"target":"_blank"},"children":[{"type":"text","value":"CryptoJS"}]},{"type":"text","value":" to encode the SSO payload. Unfortunately, as Sean found out, CryptoJS's default implementation does not use a standard approach to encryption."}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The crux of the problem is two parts:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"CryptoJS is using the same prefix as OpenSSL when encrypting AES data."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Itâ€™s using MD5 instead of SHA256 as a hashing mechanism, and it only does a single iteration instead of thousands (more secure)."}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sean's post showed me why neither "},{"type":"element","tag":"a","props":{"href":"https://laravel.com/docs/10.x/encryption","rel":["noopener","noreferer"],"target":"_blank"},"children":[{"type":"text","value":"Laravel's Encryption service"}]},{"type":"text","value":" nor a basic "},{"type":"element","tag":"a","props":{"href":"https://www.php.net/manual/en/function.openssl-decrypt.php","rel":["noopener","noreferer"],"target":"_blank"},"children":[{"type":"text","value":"OpenSSL decrypt"}]},{"type":"text","value":" implementation were working. After some rounds of interpreting their Python example to PHP, I ended up back at Google assuming someone somewhere had run into this problem before."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"As usual, StackOverflow came to the rescue, with a question aptly titled "},{"type":"element","tag":"a","props":{"href":"https://stackoverflow.com/a/65235352","rel":["noopener","noreferer"],"target":"_blank"},"children":[{"type":"text","value":"Decrypt Crypto-js encrypted text with key with PHP"}]},{"type":"text","value":". The answer's code showed PHP's "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hash_init"}]},{"type":"text","value":", "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hash_update"}]},{"type":"text","value":", and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hash_final"}]},{"type":"text","value":" methods matched the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"hasher"}]},{"type":"text","value":" update and digest functionality in Python."}]},{"type":"element","tag":"h3","props":{"id":"code"},"children":[{"type":"text","value":"Code"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here's the functionality, cleaned up a little and implemented as a class. I avoided using parameter and return types for increased compatibility."}]},{"type":"element","tag":"code","props":{"code":"/**\n * CryptoJS compatibility module\n */\nclass CryptoJs\n{\n    /**\n     * Decrypt a payload encrypted with a passphrase\n     *\n     * @see https://stackoverflow.com/a/65235352\n     *\n     * @param string $payload\n     * @param string $passphrase\n     * @return string\n     */\n    public static function decrypt($payload, $passphrase)\n    {\n        $ciphertext = base64_decode($payload);\n\n        if (substr($ciphertext, 0, 8) != \"Salted__\") {\n            return false;\n        }\n\n        $salt = substr($ciphertext, 8, 8);\n\n        $keyAndIV = self::deriveKeyAndIv($passphrase, $salt);\n\n        return openssl_decrypt(\n            substr($ciphertext, 16),\n            \"aes-256-cbc\",\n            $keyAndIV[\"key\"],\n            OPENSSL_RAW_DATA, // base64 was already decoded\n            $keyAndIV[\"iv\"]\n        );\n    }\n\n    /**\n     * Derive key from the given passphrase and salt.\n     *\n     * @param string $passphrase\n     * @param string $salt\n     * @param integer $keySize\n     * @param integer $ivSize\n     * @param integer $iterations\n     * @param string $hashAlgorithm\n     * @return void\n     */\n    private static function deriveKeyAndIv($passphrase, $salt, $keySize = 8, $ivSize = 4, $iterations = 1, $hashAlgorithm = \"md5\")\n    {\n        $targetKeySize = $keySize + $ivSize;\n        $derivedBytes = \"\";\n        $numberOfDerivedWords = 0;\n        $block = NULL;\n        $hasher = hash_init($hashAlgorithm);\n\n        while ($numberOfDerivedWords < $targetKeySize) {\n            if ($block != NULL) {\n                hash_update($hasher, $block);\n            }\n\n            hash_update($hasher, $passphrase);\n            hash_update($hasher, $salt);\n            $block = hash_final($hasher, TRUE);\n            $hasher = hash_init($hashAlgorithm);\n\n            // Iterations\n            for ($i = 1; $i < $iterations; $i++) {\n                hash_update($hasher, $block);\n                $block = hash_final($hasher, TRUE);\n                $hasher = hash_init($hashAlgorithm);\n            }\n\n            $derivedBytes .= substr($block, 0, min(strlen($block), ($targetKeySize - $numberOfDerivedWords) * 4));\n            $numberOfDerivedWords += strlen($block) / 4;\n        }\n\n        return array(\n            \"key\" => substr($derivedBytes, 0, $keySize * 4),\n            \"iv\"  => substr($derivedBytes, $keySize * 4, $ivSize * 4)\n        );\n    }\n}\n","language":"php","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"/**"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" * CryptoJS compatibility module"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" */"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-711a65"},"children":[{"type":"text","value":"CryptoJs"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"{"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"/**"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     * Decrypt a payload encrypted with a passphrase"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     *"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     * "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"@see"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" https://stackoverflow.com/a/65235352"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     *"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     * "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"@param"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" $payload"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     * "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"@param"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" $passphrase"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     * "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"@return"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"string"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     */"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"public"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"static"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-1a0873"},"children":[{"type":"text","value":"decrypt"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($payload, $passphrase)"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"    {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"        $ciphertext "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"base64_decode"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($payload);"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"substr"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($ciphertext, "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"8"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"!="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-166a79"},"children":[{"type":"text","value":"\"Salted__\""}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"false"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"        }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"        $salt "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"substr"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($ciphertext, "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"8"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"8"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"        $keyAndIV "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"self::"}]},{"type":"element","tag":"span","props":{"class":"ct-1a0873"},"children":[{"type":"text","value":"deriveKeyAndIv"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($passphrase, $salt);"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"openssl_decrypt"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"("}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"substr"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($ciphertext, "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"16"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"),"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-166a79"},"children":[{"type":"text","value":"\"aes-256-cbc\""}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":","}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            $keyAndIV["}]},{"type":"element","tag":"span","props":{"class":"ct-166a79"},"children":[{"type":"text","value":"\"key\""}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"],"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"OPENSSL_RAW_DATA"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"// base64 was already decoded"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            $keyAndIV["}]},{"type":"element","tag":"span","props":{"class":"ct-166a79"},"children":[{"type":"text","value":"\"iv\""}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"]"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"        );"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"/**"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     * Derive key from the given passphrase and salt."}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     *"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     * "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"@param"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" $passphrase"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     * "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"@param"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" $salt"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     * "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"@param"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"integer"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" $keySize"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     * "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"@param"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"integer"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" $ivSize"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     * "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"@param"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"integer"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" $iterations"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     * "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"@param"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"string"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" $hashAlgorithm"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     * "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"@return"}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"void"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"     */"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"private"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"static"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-1a0873"},"children":[{"type":"text","value":"deriveKeyAndIv"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($passphrase, $salt, $keySize "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"8"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":", $ivSize "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"4"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":", $iterations "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":", $hashAlgorithm "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-166a79"},"children":[{"type":"text","value":"\"md5\""}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"    {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"        $targetKeySize "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" $keySize "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" $ivSize;"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"        $derivedBytes "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-166a79"},"children":[{"type":"text","value":"\"\""}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"        $numberOfDerivedWords "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"        $block "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"NULL"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"        $hasher "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"hash_init"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($hashAlgorithm);"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"while"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" ($numberOfDerivedWords "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" $targetKeySize) {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" ($block "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"!="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"NULL"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"                "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"hash_update"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($hasher, $block);"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"hash_update"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($hasher, $passphrase);"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"hash_update"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($hasher, $salt);"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            $block "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"hash_final"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($hasher, "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"TRUE"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            $hasher "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"hash_init"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($hashAlgorithm);"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-bd97d6"},"children":[{"type":"text","value":"// Iterations"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" ($i "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"; $i "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" $iterations; $i"}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"++"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":") {"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"                "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"hash_update"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($hasher, $block);"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"                $block "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"hash_final"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($hasher, "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"TRUE"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":");"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"                $hasher "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"hash_init"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($hashAlgorithm);"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            $derivedBytes "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":".="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"substr"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($block, "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"min"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"strlen"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($block), ($targetKeySize "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" $numberOfDerivedWords) "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"4"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"));"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            $numberOfDerivedWords "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"+="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"strlen"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($block) "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"4"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":";"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"        }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"array"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"("}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-166a79"},"children":[{"type":"text","value":"\"key\""}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"substr"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($derivedBytes, "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":", $keySize "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"4"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"),"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-166a79"},"children":[{"type":"text","value":"\"iv\""}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"substr"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($derivedBytes, $keySize "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"4"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":", $ivSize "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"4"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":")"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"        );"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"    }"}]}]},{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This class can be used to decrypt the SSO payload like this:"}]},{"type":"element","tag":"code","props":{"code":"$data = CryptoJs::decrypt($ssoPayload, $ssoPassphrase);\n","language":"php","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"div","props":{"class":"line"},"children":[{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"$data "}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dd1cad"},"children":[{"type":"text","value":"CryptoJs"}]},{"type":"element","tag":"span","props":{"class":"ct-64dd25"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-1a0873"},"children":[{"type":"text","value":"decrypt"}]},{"type":"element","tag":"span","props":{"class":"ct-dfecf0"},"children":[{"type":"text","value":"($ssoPayload, $ssoPassphrase);"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Good luck on your implementation!"}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-166a79{color:#A5D6FF}\n.ct-dd1cad{color:#79C0FF}\n.ct-1a0873{color:#D2A8FF}\n.ct-711a65{color:#FFA657}\n.ct-dfecf0{color:#C9D1D9}\n.ct-64dd25{color:#FF7B72}\n.ct-bd97d6{color:#8B949E}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"the-challenge","depth":3,"text":"The Challenge"},{"id":"code","depth":3,"text":"Code"}]}},"_type":"markdown","_id":"content:blog:high-level-decrypting-sso-sessions-with-php.md","_source":"content","_file":"blog/high-level-decrypting-sso-sessions-with-php.md","_extension":"md"}
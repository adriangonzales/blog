<!DOCTYPE html>
<html >
<head><meta charset="utf-8">
<title>HighLevel: Decrypting SSO sessions with PHP | Adrian Gonzales</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Adrian Gonzales">
<meta property="article:published_time" content="2023-11-21">
<meta property="og:title" content="HighLevel: Decrypting SSO sessions with PHP">
<meta property="og:url" content="https://virexmachina.com/blog/high-level-decrypting-sso-sessions-with-php/">
<meta property="og:description" content="Using PHP to decrypt the HighLevel SSO payload">
<meta name="image" property="og:image" content="https://virexmachina.com/card-og.png">
<meta property="og:type" content="Article">
<meta property="og:image:type" content="image/undefined">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:image:alt">
<meta name="twitter:card" content="Summary">
<meta name="twitter:title" content="HighLevel: Decrypting SSO sessions with PHP">
<meta name="twitter:url" content="https://virexmachina.com/blog/high-level-decrypting-sso-sessions-with-php/">
<meta name="twitter:description" content="Using PHP to decrypt the HighLevel SSO payload">
<meta name="twitter:image" content="https://virexmachina.com/card-twitter.png">
<meta name="twitter:image:alt">
<link rel="canonical" href="https://virexmachina.com/blog/high-level-decrypting-sso-sessions-with-php/">
<script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://virexmachina.com/"},"url":"https://virexmachina.com/blog/high-level-decrypting-sso-sessions-with-php/","image":"https://virexmachina.com/card-og.png","headline":"HighLevel: Decrypting SSO sessions with PHP","abstract":"Using PHP to decrypt the HighLevel SSO payload","datePublished":"2023-11-21T12:00:00","dateModified":"2023-11-21T12:00:00","author":{"@context":"http://www.schema.org","@type":"Person","@id":"https://virexmachina.com/","name":"Adrian Gonzales","alternateName":"Adrian Gonzales","jobTitle":"CTO","worksFor":[{"@type":"Organization","name":"MarketMuscles","sameAs":["https://marketmuscles.com/"]}],"url":"https://virexmachina.com/","image":"https://virexmachina.com/img/card-og.png","sameAs":["https://virexmachina.com/"]},"publisher":{"@context":"http://www.schema.org","@type":"Person","@id":"https://virexmachina.com/","name":"Adrian Gonzales","alternateName":"Adrian Gonzales","jobTitle":"CTO","worksFor":[{"@type":"Organization","name":"MarketMuscles","sameAs":["https://marketmuscles.com/"]}],"url":"https://virexmachina.com/","image":"https://virexmachina.com/img/card-og.png","sameAs":["https://virexmachina.com/"]}}</script>
<meta name="og:title" content="HighLevel: Decrypting SSO sessions with PHP | Adrian Gonzales">
<meta name="description" content="Using PHP to decrypt the HighLevel SSO payload">
<meta name="og:description" content="Using PHP to decrypt the HighLevel SSO payload"><link rel="modulepreload" href="/blog/high-level-decrypting-sso-sessions-with-php/_payload.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/entry.acb1fcef.js"><link rel="preload" as="style" href="/_nuxt/entry.829fda21.css"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_...slug_.26ea9c26.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/primary.3ba64f75.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/nuxt-link.fe8c71f9.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/chevronDown.0da5e768.js"><link rel="preload" as="style" href="/_nuxt/section.438470a0.css"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRenderer.e2709920.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRendererMarkdown.d2aa0a27.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/index.a6ef77ff.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentDoc.4cbd78d1.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/composables.ed9beac4.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentQuery.4cf8ba0c.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/query.057f1d9c.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/utils.966ab5a8.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseP.f76cc4e6.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseA.58a0bca4.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseH3.e3bda208.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseBlockquote.eea7abf6.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseUl.43d61ab5.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseLi.d5736ac6.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseCodeInline.e4026ae0.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseCode.2b2b0fd6.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/error-component.19fba9f9.js"><link rel="stylesheet" href="/_nuxt/entry.829fda21.css"><link rel="stylesheet" href="/_nuxt/section.438470a0.css"><style>.blog-aside[data-v-547b1330]{position:sticky;top:4.25rem}.blog-aside-wrapper[data-v-547b1330]{--tw-border-opacity:1;border-bottom-width:2px;border-color:#284920;border-color:rgb(40 73 32/var(--tw-border-opacity));border-top-width:2px;display:flex;flex-direction:column;padding-bottom:1rem;padding-top:1rem}.blog-post-text[data-v-547b1330]{--tw-text-opacity:1;color:#284920;color:rgb(40 73 32/var(--tw-text-opacity))}.separator[data-v-547b1330]{margin-left:.25rem;margin-right:.25rem}</style><style>.toc-link_3[data-v-bd905aac]{padding-left:1rem}.toc-link_3[data-v-bd905aac]:before{content:"-";padding-right:.5rem}</style><style>.container[data-v-5db9d261]{--tw-bg-opacity:1;background-color:#000;background-color:rgb(0 0 0/var(--tw-bg-opacity));border-color:rgba(110,169,74,.5);border-radius:.375rem;border-width:1px;margin-bottom:1.5rem;margin-top:1.5rem;overflow:hidden;padding-top:2rem;position:relative;width:100%}pre[data-v-5db9d261-s]{counter-reset:lines;display:flex;font-size:.875rem;line-height:1.625;overflow-x:auto;padding-bottom:1rem;padding-left:1rem;padding-right:1rem}@media (min-width:768px){pre[data-v-5db9d261-s]{font-size:1rem}}.container pre>code .line[data-v-5db9d261]{overflow-wrap:break-word}.bottom-container[data-v-5db9d261]{bottom:1rem;padding-bottom:.5rem;padding-right:.5rem;position:absolute;right:0}@media (min-width:768px){.bottom-container[data-v-5db9d261]{top:2.5rem}}.copy-container[data-v-5db9d261]{display:flex}.filename-text[data-v-5db9d261]{color:hsla(84,41%,93%,.75);font-size:.75rem;left:1rem;padding-bottom:.25rem;padding-top:.25rem;position:absolute;top:0}@media (min-width:768px){.filename-text[data-v-5db9d261]{font-size:.875rem}}.language-text[data-v-5db9d261]{--tw-bg-opacity:1;--tw-text-opacity:1;background-color:#6ea94a;background-color:rgb(110 169 74/var(--tw-bg-opacity));border-bottom-left-radius:.375rem;color:#eef4e5;color:rgb(238 244 229/var(--tw-text-opacity));padding:.25rem .5rem;position:absolute;right:0;top:0}pre code[data-v-5db9d261-s]{display:flex;flex-direction:column;width:100%}pre code .line[data-v-5db9d261-s]{display:inline-table;min-height:1rem}pre code .line[data-v-5db9d261-s]:before{color:rgba(115,138,148,.4);content:counter(lines);counter-increment:lines;display:inline-block;margin-right:1.5rem;text-align:left;width:1rem}pre code .highlight[data-v-5db9d261-s]{--tw-border-opacity:1;background-color:#363b46;border-color:#6ea94a;border-color:rgb(110 169 74/var(--tw-border-opacity));border-left-width:4px;content:"";display:block;margin-left:-1rem;margin-right:-1rem;padding-left:.75rem;padding-right:1rem}</style></head>
<body ><div id="__nuxt"><main id="main"><!--[--><main class="blog-post-text" data-v-547b1330><div class="bg-chelsea-cucumber-900 text-chelsea-cucumber-500 relative px-6 py-6 sm:px-20" data-v-547b1330><div class="flex flex-col items-center justify-between sm:flex-row relative z-20"><a href="/" class=""><svg width="523px" height="54px" viewbox="0 0 523 54" version="1.1" xmlns="http://www.w3.org/2000/svg" class="w-64"><g id="logo-type-full" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path id="AdrianGonzales" d="M13.38,52 L13.38,50.92 L7.98,48.76 L12.732,37.24 L29.94,37.24 L33.612,45.88 C34.38,47.704 35.556,49.18 37.14,50.308 C38.724,51.436 40.764,52 43.26,52 L43.26,52 L51.9,52 L51.9,50.92 L48.3,49.84 L27.78,0.88 L25.62,0.88 L5.82,48.76 L0.06,50.92 L0.06,52 L13.38,52 Z M29.22,35.44 L13.452,35.44 L21.3,16.504 L29.22,35.44 Z M62.6,53.08 C65.816,53.08 68.504,52 70.664,49.84 C71.624,48.88 72.416,47.8 73.04,46.6 C73.424,47.704 73.952,48.616 74.624,49.336 C76.208,51.112 78.44,52 81.32,52 L81.32,52 L87.8,52 L87.8,50.92 L83.48,49.84 L83.48,8.08 C83.48,3.76 81.32,1.6 77,1.6 L77,1.6 L67.64,1.6 L67.64,2.68 L71.96,3.76 L71.96,17.8 C71.192,17.176 70.448,16.696 69.728,16.36 C68,15.4 65.984,14.92 63.68,14.92 C58.832,14.92 54.98,16.564 52.124,19.852 C49.268,23.14 47.84,27.856 47.84,34 C47.84,38.08 48.488,41.548 49.784,44.404 C51.08,47.26 52.832,49.42 55.04,50.884 C57.248,52.348 59.768,53.08 62.6,53.08 Z M65.48,50.56 C63.944,50.56 62.66,49.348 61.628,46.924 C60.596,44.5 60.08,40.192 60.08,34 C60.08,27.52 60.644,23.08 61.772,20.68 C62.9,18.28 64.496,17.08 66.56,17.08 C67.76,17.08 69.008,17.56 70.304,18.52 C70.88,18.952 71.432,19.432 71.96,19.96 L71.96,19.96 L71.96,44.8 C71.384,46 70.832,46.96 70.304,47.68 C68.864,49.6 67.256,50.56 65.48,50.56 Z M107.14,52 L107.14,50.92 L102.82,49.84 L102.82,23.2 C103.396,22.24 104.164,21.28 105.124,20.32 C107.14,18.4 109.372,17.44 111.82,17.44 L111.82,17.44 L111.82,27.52 L112.684,27.736 C113.356,27.832 114.028,27.88 114.7,27.88 C116.332,27.88 117.64,27.388 118.624,26.404 C119.608,25.42 120.1,24.112 120.1,22.48 C120.1,20.272 119.464,18.58 118.192,17.404 C116.92,16.228 115.012,15.64 112.468,15.64 C109.492,15.64 106.804,16.6 104.404,18.52 C103.348,19.384 102.46,20.344 101.74,21.4 C101.308,20.344 100.78,19.456 100.156,18.736 C98.524,16.912 96.292,16 93.46,16 L93.46,16 L86.98,16 L86.98,17.08 L91.3,18.16 L91.3,49.84 L86.98,50.92 L86.98,52 L107.14,52 Z M129.2,11.68 C130.64,11.68 131.84,11.2 132.8,10.24 C133.76,9.28 134.24,8.08 134.24,6.64 C134.24,5.2 133.76,4 132.8,3.04 C131.84,2.08 130.64,1.6 129.2,1.6 C127.76,1.6 126.56,2.08 125.6,3.04 C124.64,4 124.16,5.2 124.16,6.64 C124.16,8.08 124.64,9.28 125.6,10.24 C126.56,11.2 127.76,11.68 129.2,11.68 Z M140,52 L140,50.92 L135.68,49.84 L135.68,22.48 C135.68,18.16 133.52,16 129.2,16 L129.2,16 L119.84,16 L119.84,17.08 L124.16,18.16 L124.16,49.84 L119.84,50.92 L119.84,52 L140,52 Z M152.86,53.08 C156.076,53.08 158.764,52 160.924,49.84 C161.836,48.88 162.628,47.8 163.3,46.6 C163.684,47.704 164.212,48.616 164.884,49.336 C166.468,51.112 168.7,52 171.58,52 L171.58,52 L178.06,52 L178.06,50.92 L173.74,49.84 L173.74,30.4 C173.74,27.376 173.032,24.7 171.616,22.372 C170.2,20.044 168.136,18.22 165.424,16.9 C162.712,15.58 159.484,14.92 155.74,14.92 C151.324,14.92 148,15.688 145.768,17.224 C143.536,18.76 142.42,20.632 142.42,22.84 C142.42,24.472 142.912,25.78 143.896,26.764 C144.88,27.748 146.188,28.24 147.82,28.24 C148.348,28.24 148.996,28.192 149.764,28.096 L149.764,28.096 L150.7,27.88 L150.7,17.08 L151.708,16.72 C152.428,16.48 153.292,16.36 154.3,16.36 C156.988,16.36 158.98,17.368 160.276,19.384 C161.572,21.4 162.22,25.072 162.22,30.4 L162.22,30.4 L162.22,32.56 C158.236,32.752 153.652,33.28 148.468,34.144 C146.164,34.528 144.028,34.96 142.06,35.44 C141.532,36.16 141.1,36.952 140.764,37.816 C139.948,39.64 139.54,41.488 139.54,43.36 C139.54,46.192 140.692,48.52 142.996,50.344 C145.3,52.168 148.588,53.08 152.86,53.08 Z M155.74,50.56 C154.492,50.56 153.46,49.912 152.644,48.616 C151.828,47.32 151.42,45.328 151.42,42.64 C151.42,40.864 151.66,39.064 152.14,37.24 C152.38,36.328 152.62,35.608 152.86,35.08 C153.388,35.032 154.396,34.912 155.884,34.72 C157.9,34.48 160.012,34.36 162.22,34.36 L162.22,34.36 L162.22,44.8 C161.644,46 161.092,46.96 160.564,47.68 C159.124,49.6 157.516,50.56 155.74,50.56 Z M197.04,52 L197.04,50.92 L192.72,49.84 L192.72,23.2 C193.152,22.096 193.68,21.136 194.304,20.32 C195.744,18.4 197.376,17.44 199.2,17.44 C200.64,17.44 201.9,18.244 202.98,19.852 C204.06,21.46 204.6,23.776 204.6,26.8 L204.6,26.8 L204.6,45.52 C204.6,49.84 206.76,52 211.08,52 L211.08,52 L220.44,52 L220.44,50.92 L216.12,49.84 L216.12,26.8 C216.12,24.784 215.52,22.864 214.32,21.04 C213.12,19.216 211.452,17.74 209.316,16.612 C207.18,15.484 204.768,14.92 202.08,14.92 C198.864,14.92 196.176,16 194.016,18.16 C193.104,19.072 192.312,20.152 191.64,21.4 C191.208,20.344 190.68,19.456 190.056,18.736 C188.424,16.912 186.192,16 183.36,16 L183.36,16 L176.88,16 L176.88,17.08 L181.2,18.16 L181.2,49.84 L176.88,50.92 L176.88,52 L197.04,52 Z M254.44,53.08 C257.656,53.08 260.344,52 262.504,49.84 C263.416,48.88 264.208,47.8 264.88,46.6 C265.216,47.656 265.792,48.616 266.608,49.48 C268.432,51.4 271.096,52.36 274.6,52.36 L274.6,52.36 L275.68,52.36 L275.68,28.24 L280,27.16 L280,26.08 L259.48,26.08 L259.48,27.16 L263.8,28.24 L263.8,44.8 C263.224,46 262.672,46.96 262.144,47.68 C260.704,49.6 259.096,50.56 257.32,50.56 C254.248,50.56 251.74,48.76 249.796,45.16 C247.852,41.56 246.88,35.44 246.88,26.8 C246.88,18.16 247.972,11.92 250.156,8.08 C252.34,4.24 255.088,2.32 258.4,2.32 C260.608,2.32 262.564,2.92 264.268,4.12 C265.972,5.32 267.4,6.832 268.552,8.656 C269.8,10.528 270.736,12.616 271.36,14.92 L271.36,14.92 L274.24,14.92 L274.24,1.24 L272.44,1.24 C272.344,1.288 271.864,1.624 271,2.248 C270.136,2.968 269.296,3.952 268.48,5.2 C267.424,4.24 266.368,3.472 265.312,2.896 C262.528,1.312 259.768,0.52 257.032,0.52 C252.52,0.52 248.548,1.54 245.116,3.58 C241.684,5.62 239.02,8.62 237.124,12.58 C235.228,16.54 234.28,21.28 234.28,26.8 C234.28,32.272 235.192,36.988 237.016,40.948 C238.84,44.908 241.288,47.92 244.36,49.984 C247.432,52.048 250.792,53.08 254.44,53.08 Z M297.18,53.08 C303.132,53.08 307.8,51.388 311.184,48.004 C314.568,44.62 316.26,39.952 316.26,34 C316.26,28.048 314.568,23.38 311.184,19.996 C307.8,16.612 303.132,14.92 297.18,14.92 C291.228,14.92 286.56,16.612 283.176,19.996 C279.792,23.38 278.1,28.048 278.1,34 C278.1,39.952 279.792,44.62 283.176,48.004 C286.56,51.388 291.228,53.08 297.18,53.08 Z M297.18,51.64 C295.26,51.64 293.64,50.296 292.32,47.608 C291,44.92 290.34,40.384 290.34,34 C290.34,27.616 291,23.08 292.32,20.392 C293.64,17.704 295.26,16.36 297.18,16.36 C299.1,16.36 300.72,17.704 302.04,20.392 C303.36,23.08 304.02,27.616 304.02,34 C304.02,40.384 303.36,44.92 302.04,47.608 C300.72,50.296 299.1,51.64 297.18,51.64 Z M336.68,52 L336.68,50.92 L332.36,49.84 L332.36,23.2 C332.792,22.096 333.32,21.136 333.944,20.32 C335.384,18.4 337.016,17.44 338.84,17.44 C340.28,17.44 341.54,18.244 342.62,19.852 C343.7,21.46 344.24,23.776 344.24,26.8 L344.24,26.8 L344.24,45.52 C344.24,49.84 346.4,52 350.72,52 L350.72,52 L360.08,52 L360.08,50.92 L355.76,49.84 L355.76,26.8 C355.76,24.784 355.16,22.864 353.96,21.04 C352.76,19.216 351.092,17.74 348.956,16.612 C346.82,15.484 344.408,14.92 341.72,14.92 C338.504,14.92 335.816,16 333.656,18.16 C332.744,19.072 331.952,20.152 331.28,21.4 C330.848,20.344 330.32,19.456 329.696,18.736 C328.064,16.912 325.832,16 323,16 L323,16 L316.52,16 L316.52,17.08 L320.84,18.16 L320.84,49.84 L316.52,50.92 L316.52,52 L336.68,52 Z M395.38,52 L395.38,39.4 L393.22,39.4 C392.308,40.168 391.516,41.104 390.844,42.208 C389.308,44.8 388.54,47.464 388.54,50.2 L388.54,50.2 L374.86,50.2 L395.38,17.8 L395.38,16 L362.62,16 L362.62,28.6 L364.78,28.6 C365.692,27.736 366.46,26.8 367.084,25.792 C368.668,23.104 369.46,20.44 369.46,17.8 L369.46,17.8 L382.42,17.8 L361.9,50.2 L361.9,52 L395.38,52 Z M409.68,53.08 C412.896,53.08 415.584,52 417.744,49.84 C418.656,48.88 419.448,47.8 420.12,46.6 C420.504,47.704 421.032,48.616 421.704,49.336 C423.288,51.112 425.52,52 428.4,52 L428.4,52 L434.88,52 L434.88,50.92 L430.56,49.84 L430.56,30.4 C430.56,27.376 429.852,24.7 428.436,22.372 C427.02,20.044 424.956,18.22 422.244,16.9 C419.532,15.58 416.304,14.92 412.56,14.92 C408.144,14.92 404.82,15.688 402.588,17.224 C400.356,18.76 399.24,20.632 399.24,22.84 C399.24,24.472 399.732,25.78 400.716,26.764 C401.7,27.748 403.008,28.24 404.64,28.24 C405.168,28.24 405.816,28.192 406.584,28.096 L406.584,28.096 L407.52,27.88 L407.52,17.08 L408.528,16.72 C409.248,16.48 410.112,16.36 411.12,16.36 C413.808,16.36 415.8,17.368 417.096,19.384 C418.392,21.4 419.04,25.072 419.04,30.4 L419.04,30.4 L419.04,32.56 C415.056,32.752 410.472,33.28 405.288,34.144 C402.984,34.528 400.848,34.96 398.88,35.44 C398.352,36.16 397.92,36.952 397.584,37.816 C396.768,39.64 396.36,41.488 396.36,43.36 C396.36,46.192 397.512,48.52 399.816,50.344 C402.12,52.168 405.408,53.08 409.68,53.08 Z M412.56,50.56 C411.312,50.56 410.28,49.912 409.464,48.616 C408.648,47.32 408.24,45.328 408.24,42.64 C408.24,40.864 408.48,39.064 408.96,37.24 C409.2,36.328 409.44,35.608 409.68,35.08 C410.208,35.032 411.216,34.912 412.704,34.72 C414.72,34.48 416.832,34.36 419.04,34.36 L419.04,34.36 L419.04,44.8 C418.464,46 417.912,46.96 417.384,47.68 C415.944,49.6 414.336,50.56 412.56,50.56 Z M455.86,52 L455.86,50.92 L451.54,49.84 L451.54,8.08 C451.54,3.76 449.38,1.6 445.06,1.6 L445.06,1.6 L435.7,1.6 L435.7,2.68 L440.02,3.76 L440.02,49.84 L435.7,50.92 L435.7,52 L455.86,52 Z M474.12,53.08 C476.808,53.08 479.184,52.564 481.248,51.532 C483.312,50.5 484.92,49.12 486.072,47.392 C487.224,45.664 487.8,43.84 487.8,41.92 L487.8,41.92 L486,41.92 C486,43.456 485.532,44.956 484.596,46.42 C483.66,47.884 482.388,49.06 480.78,49.948 C479.172,50.836 477.432,51.28 475.56,51.28 C472.872,51.28 470.76,50.092 469.224,47.716 C467.688,45.34 466.92,41.368 466.92,35.8 C472.056,35.8 477.144,35.44 482.184,34.72 C484.584,34.432 486.816,34.072 488.88,33.64 L488.88,33.64 L489.24,32.416 C489.48,31.552 489.6,30.52 489.6,29.32 C489.6,26.68 488.892,24.268 487.476,22.084 C486.06,19.9 484.044,18.16 481.428,16.864 C478.812,15.568 475.776,14.92 472.32,14.92 C468.864,14.92 465.804,15.688 463.14,17.224 C460.476,18.76 458.4,20.968 456.912,23.848 C455.424,26.728 454.68,30.112 454.68,34 C454.68,39.952 456.384,44.62 459.792,48.004 C463.2,51.388 467.976,53.08 474.12,53.08 Z M466.92,34 C466.92,22.24 468.72,16.36 472.32,16.36 C473.808,16.36 475.08,17.284 476.136,19.132 C477.192,20.98 477.72,23.896 477.72,27.88 C477.72,29.224 477.6,30.496 477.36,31.696 C477.168,32.512 477.048,33.04 477,33.28 C476.088,33.472 475.224,33.592 474.408,33.64 C472.488,33.88 469.992,34 466.92,34 Z M506.42,53.08 C517.46,53.08 522.98,49.6 522.98,42.64 C522.98,40.72 522.44,39.04 521.36,37.6 C520.28,36.16 518.984,34.948 517.472,33.964 C515.96,32.98 513.932,31.84 511.388,30.544 C508.268,28.96 505.94,27.556 504.404,26.332 C502.868,25.108 502.1,23.584 502.1,21.76 C502.1,20.32 502.556,19.12 503.468,18.16 C504.38,17.2 505.484,16.72 506.78,16.72 C510.092,16.72 512.948,18.592 515.348,22.336 C516.404,23.968 517.292,25.816 518.012,27.88 L518.012,27.88 L520.892,27.88 L520.892,15.64 L519.092,15.64 C518.948,15.688 518.468,15.952 517.652,16.432 C516.596,17.2 515.756,18.016 515.132,18.88 C514.364,18.208 513.452,17.56 512.396,16.936 C510.236,15.592 507.884,14.92 505.34,14.92 C500.204,14.92 496.4,15.82 493.928,17.62 C491.456,19.42 490.22,21.76 490.22,24.64 C490.22,26.752 490.784,28.588 491.912,30.148 C493.04,31.708 494.408,33.004 496.016,34.036 C497.624,35.068 499.724,36.232 502.316,37.528 C505.34,39.112 507.56,40.444 508.976,41.524 C510.392,42.604 511.1,43.936 511.1,45.52 C511.1,47.392 510.584,48.82 509.552,49.804 C508.52,50.788 506.996,51.28 504.98,51.28 C501.188,51.28 498.02,49.432 495.476,45.736 C494.276,44.008 493.364,42.136 492.74,40.12 L492.74,40.12 L489.86,40.12 L489.86,52.36 L491.66,52.36 C492.188,52.12 492.668,51.856 493.1,51.568 C494.012,50.992 494.852,50.176 495.62,49.12 C496.34,49.84 497.276,50.512 498.428,51.136 C500.78,52.432 503.444,53.08 506.42,53.08 Z" fill="currentColor" fill-rule="nonzero"></path></g></svg></a><nav class="flex items-center gap-6"><a href="/blog/" class="bg-chelsea-cucumber-500 hover:bg-chelsea-cucumber-400 text-chelsea-cucumber-950 transition-color rounded px-5 py-2.5 duration-300 ease-out"><!--[-->Blog<!--]--></a></nav></div><div class="bg-topographic-map-pattern-1 absolute inset-0 z-10 bg-cover opacity-5 mix-blend-screen"> </div></div><!--[--><header class="px-section_x_sm py-section_y_sm sm:px-section_x sm:py-section_y relative bg-chelsea-cucumber-50 mb-12 text-typography_primary" id="blog-title" data-v-547b1330 data-v-f604807b><!--[--><div class="mb-12 flex flex-col items-center md:mb-8 md:flex-row md:justify-between md:text-right" data-v-547b1330><ol itemscope itemtype="https://schema.org/BreadcrumbList" class="blog-breadcrumb" data-v-547b1330><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem" data-v-547b1330><a href="/" class="" itemprop="item" data-v-547b1330><span itemprop="name" data-v-547b1330>Home</span></a><meta itemprop="position" content="1" data-v-547b1330></li><li class="separator" data-v-547b1330>/</li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem" data-v-547b1330><a href="/blog/" class="" itemscope itemtype="https://schema.org/WebPage" itemprop="item" itemid="/blog/" data-v-547b1330><span itemprop="name" data-v-547b1330>Blog</span></a><meta itemprop="position" content="2" data-v-547b1330></li><li class="separator" data-v-547b1330>/</li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem" data-v-547b1330><span itemprop="name" data-v-547b1330>HighLevel: Decrypting SSO sessions with PHP</span><meta itemprop="position" content="3" data-v-547b1330></li></ol><span class="dark:text-typography_primary_dark/75 mt-2 font-light text-typography_primary/75 md:mt-0" data-v-547b1330>Tuesday, November 21, 2023</span></div><h1 class="blog-post-text mb-4 text-center text-h3 font-bold leading-h3 md:mb-6 md:text-left md:text-h1 md:leading-h1" data-v-547b1330>HighLevel: Decrypting SSO sessions with PHP</h1><p class="blog-post-text mb-8 text-center md:w-8/12 md:text-left md:text-lg md:leading-lg" data-v-547b1330>Using PHP to decrypt the HighLevel SSO payload</p><!--]--></header><section class="px-section_x_sm py-section_y_sm sm:px-section_x sm:py-section_y relative relative grid grid-cols-10 gap-8 !pt-0 lg:gap-12" id="main" data-v-547b1330 data-v-f604807b><!--[--><aside class="col-span-full md:col-span-3 md:hidden" data-v-547b1330><div class="blog-post-text blog-aside-wrapper mb-2" data-v-547b1330><nav class="toc" data-v-547b1330 data-v-bd905aac><header class="flex cursor-pointer flex-row items-center justify-between mb-2" aria-label="Expand the table of contents." data-v-bd905aac><span class="blog-aside-title mb-0" data-v-bd905aac>Table of Contents</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="h-6 w-6 transform" width="24" height="24" data-v-bd905aac><path fill="currentColor" d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"></path></svg></header><ul class="block" data-v-bd905aac><!--[--><li class="toc-link_3 mt-2 first:mt-0 md:mt-1" data-v-bd905aac><a href="#the-challenge" class="hover:text-brand_primary hover:underline" data-v-bd905aac>The Challenge</a></li><li class="toc-link_3 mt-2 first:mt-0 md:mt-1" data-v-bd905aac><a href="#code" class="hover:text-brand_primary hover:underline" data-v-bd905aac>Code</a></li><!--]--></ul></nav></div></aside><article class="prose relative col-span-full md:col-span-7" data-v-547b1330><span class="dark:text-typography_primary_dark/75 absolute -top-8 text-sm font-light italic leading-sm text-typography_primary/75" style="display:none;" data-v-547b1330>(Updated: )</span><div class="blog-content blog-post-text" data-v-547b1330><p><!--[-->I&#39;m working on an extensive custom integration with <a href="https://www.gohighlevel.com/" rel="noopener noreferer" target="_blank"><!--[-->HighLevel<!--]--></a>, now possible because they recently built a single-sign-on process that allows web applications embedded in iFrames to validate that they are being loaded within the HL interface, as well as retrieve information about the current user and account viewing the application.<!--]--></p><h3 id="the-challenge"><a href="#the-challenge"><!--[-->The Challenge<!--]--></a></h3><p><!--[-->This process is an interesting challenge due to security concerns and cross-domain resources loaded in iFrames.<!--]--></p><p><!--[-->The official documentation around this feature is very limited, mostly <a href="https://github.com/GoHighLevel/ghl-marketplace-app-template#sso" rel="noopener noreferer" target="_blank"><!--[-->this example implementation<!--]--></a>. Thankfully, talented people are sharing their knowledge, like <a href="https://www.youtube.com/watch?v=3rveQDuVlR0" rel="noopener noreferer" target="_blank"><!--[-->Sergio Leon&#39;s video explaining the SSO process<!--]--></a> and <a href="https://seankerr.dev/posts/decrypting-highlevel-sso-session-using-python/" rel="noopener noreferer" target="_blank"><!--[-->Sean Kerr&#39;s blog post adapting the process to Python<!--]--></a>. The obvious challenge was implementing the decryption logic in PHP.<!--]--></p><p><!--[-->HighLevel uses <a href="https://github.com/brix/crypto-js" rel="noopener noreferer" target="_blank"><!--[-->CryptoJS<!--]--></a> to encode the SSO payload. Unfortunately, as Sean found out, CryptoJS&#39;s default implementation does not use a standard approach to encryption.<!--]--></p><blockquote><!--[--><p><!--[-->The crux of the problem is two parts:<!--]--></p><ul><!--[--><li><!--[-->CryptoJS is using the same prefix as OpenSSL when encrypting AES data.<!--]--></li><li><!--[-->It’s using MD5 instead of SHA256 as a hashing mechanism, and it only does a single iteration instead of thousands (more secure).<!--]--></li><!--]--></ul><!--]--></blockquote><p><!--[-->Sean&#39;s post showed me why neither <a href="https://laravel.com/docs/10.x/encryption" rel="noopener noreferer" target="_blank"><!--[-->Laravel&#39;s Encryption service<!--]--></a> nor a basic <a href="https://www.php.net/manual/en/function.openssl-decrypt.php" rel="noopener noreferer" target="_blank"><!--[-->OpenSSL decrypt<!--]--></a> implementation were working. After some rounds of interpreting their Python example to PHP, I ended up back at Google assuming someone somewhere had run into this problem before.<!--]--></p><p><!--[-->As usual, StackOverflow came to the rescue, with a question aptly titled <a href="https://stackoverflow.com/a/65235352" rel="noopener noreferer" target="_blank"><!--[-->Decrypt Crypto-js encrypted text with key with PHP<!--]--></a>. The answer&#39;s code showed PHP&#39;s <code><!--[-->hash_init<!--]--></code>, <code><!--[-->hash_update<!--]--></code>, and <code><!--[-->hash_final<!--]--></code> methods matched the <code><!--[-->hasher<!--]--></code> update and digest functionality in Python.<!--]--></p><h3 id="code"><a href="#code"><!--[-->Code<!--]--></a></h3><p><!--[-->Here&#39;s the functionality, cleaned up a little and implemented as a class. I avoided using parameter and return types for increased compatibility.<!--]--></p><div class="container group" data-v-5db9d261><!----><!----><!--[--><pre data-v-5db9d261-s><code data-v-5db9d261-s><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>/**</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s> * CryptoJS compatibility module</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s> */</span></div><div class="line" data-v-5db9d261-s><span class="ct-64dd25" data-v-5db9d261-s>class</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-711a65" data-v-5db9d261-s>CryptoJs</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>{</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>    </span><span class="ct-bd97d6" data-v-5db9d261-s>/**</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     * Decrypt a payload encrypted with a passphrase</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     *</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     * </span><span class="ct-64dd25" data-v-5db9d261-s>@see</span><span class="ct-bd97d6" data-v-5db9d261-s> https://stackoverflow.com/a/65235352</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     *</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     * </span><span class="ct-64dd25" data-v-5db9d261-s>@param</span><span class="ct-bd97d6" data-v-5db9d261-s> </span><span class="ct-64dd25" data-v-5db9d261-s>string</span><span class="ct-bd97d6" data-v-5db9d261-s> $payload</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     * </span><span class="ct-64dd25" data-v-5db9d261-s>@param</span><span class="ct-bd97d6" data-v-5db9d261-s> </span><span class="ct-64dd25" data-v-5db9d261-s>string</span><span class="ct-bd97d6" data-v-5db9d261-s> $passphrase</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     * </span><span class="ct-64dd25" data-v-5db9d261-s>@return</span><span class="ct-bd97d6" data-v-5db9d261-s> </span><span class="ct-64dd25" data-v-5db9d261-s>string</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     */</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>    </span><span class="ct-64dd25" data-v-5db9d261-s>public</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-64dd25" data-v-5db9d261-s>static</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-64dd25" data-v-5db9d261-s>function</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-1a0873" data-v-5db9d261-s>decrypt</span><span class="ct-dfecf0" data-v-5db9d261-s>($payload, $passphrase)</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>    {</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>        $ciphertext </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>base64_decode</span><span class="ct-dfecf0" data-v-5db9d261-s>($payload);</span></div><div class="line" data-v-5db9d261-s></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>        </span><span class="ct-64dd25" data-v-5db9d261-s>if</span><span class="ct-dfecf0" data-v-5db9d261-s> (</span><span class="ct-dd1cad" data-v-5db9d261-s>substr</span><span class="ct-dfecf0" data-v-5db9d261-s>($ciphertext, </span><span class="ct-dd1cad" data-v-5db9d261-s>0</span><span class="ct-dfecf0" data-v-5db9d261-s>, </span><span class="ct-dd1cad" data-v-5db9d261-s>8</span><span class="ct-dfecf0" data-v-5db9d261-s>) </span><span class="ct-64dd25" data-v-5db9d261-s>!=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-166a79" data-v-5db9d261-s>&quot;Salted__&quot;</span><span class="ct-dfecf0" data-v-5db9d261-s>) {</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            </span><span class="ct-64dd25" data-v-5db9d261-s>return</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>false</span><span class="ct-dfecf0" data-v-5db9d261-s>;</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>        }</span></div><div class="line" data-v-5db9d261-s></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>        $salt </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>substr</span><span class="ct-dfecf0" data-v-5db9d261-s>($ciphertext, </span><span class="ct-dd1cad" data-v-5db9d261-s>8</span><span class="ct-dfecf0" data-v-5db9d261-s>, </span><span class="ct-dd1cad" data-v-5db9d261-s>8</span><span class="ct-dfecf0" data-v-5db9d261-s>);</span></div><div class="line" data-v-5db9d261-s></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>        $keyAndIV </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-64dd25" data-v-5db9d261-s>self::</span><span class="ct-1a0873" data-v-5db9d261-s>deriveKeyAndIv</span><span class="ct-dfecf0" data-v-5db9d261-s>($passphrase, $salt);</span></div><div class="line" data-v-5db9d261-s></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>        </span><span class="ct-64dd25" data-v-5db9d261-s>return</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>openssl_decrypt</span><span class="ct-dfecf0" data-v-5db9d261-s>(</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            </span><span class="ct-dd1cad" data-v-5db9d261-s>substr</span><span class="ct-dfecf0" data-v-5db9d261-s>($ciphertext, </span><span class="ct-dd1cad" data-v-5db9d261-s>16</span><span class="ct-dfecf0" data-v-5db9d261-s>),</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            </span><span class="ct-166a79" data-v-5db9d261-s>&quot;aes-256-cbc&quot;</span><span class="ct-dfecf0" data-v-5db9d261-s>,</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            $keyAndIV[</span><span class="ct-166a79" data-v-5db9d261-s>&quot;key&quot;</span><span class="ct-dfecf0" data-v-5db9d261-s>],</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            </span><span class="ct-dd1cad" data-v-5db9d261-s>OPENSSL_RAW_DATA</span><span class="ct-dfecf0" data-v-5db9d261-s>, </span><span class="ct-bd97d6" data-v-5db9d261-s>// base64 was already decoded</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            $keyAndIV[</span><span class="ct-166a79" data-v-5db9d261-s>&quot;iv&quot;</span><span class="ct-dfecf0" data-v-5db9d261-s>]</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>        );</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>    }</span></div><div class="line" data-v-5db9d261-s></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>    </span><span class="ct-bd97d6" data-v-5db9d261-s>/**</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     * Derive key from the given passphrase and salt.</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     *</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     * </span><span class="ct-64dd25" data-v-5db9d261-s>@param</span><span class="ct-bd97d6" data-v-5db9d261-s> </span><span class="ct-64dd25" data-v-5db9d261-s>string</span><span class="ct-bd97d6" data-v-5db9d261-s> $passphrase</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     * </span><span class="ct-64dd25" data-v-5db9d261-s>@param</span><span class="ct-bd97d6" data-v-5db9d261-s> </span><span class="ct-64dd25" data-v-5db9d261-s>string</span><span class="ct-bd97d6" data-v-5db9d261-s> $salt</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     * </span><span class="ct-64dd25" data-v-5db9d261-s>@param</span><span class="ct-bd97d6" data-v-5db9d261-s> </span><span class="ct-64dd25" data-v-5db9d261-s>integer</span><span class="ct-bd97d6" data-v-5db9d261-s> $keySize</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     * </span><span class="ct-64dd25" data-v-5db9d261-s>@param</span><span class="ct-bd97d6" data-v-5db9d261-s> </span><span class="ct-64dd25" data-v-5db9d261-s>integer</span><span class="ct-bd97d6" data-v-5db9d261-s> $ivSize</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     * </span><span class="ct-64dd25" data-v-5db9d261-s>@param</span><span class="ct-bd97d6" data-v-5db9d261-s> </span><span class="ct-64dd25" data-v-5db9d261-s>integer</span><span class="ct-bd97d6" data-v-5db9d261-s> $iterations</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     * </span><span class="ct-64dd25" data-v-5db9d261-s>@param</span><span class="ct-bd97d6" data-v-5db9d261-s> </span><span class="ct-64dd25" data-v-5db9d261-s>string</span><span class="ct-bd97d6" data-v-5db9d261-s> $hashAlgorithm</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     * </span><span class="ct-64dd25" data-v-5db9d261-s>@return</span><span class="ct-bd97d6" data-v-5db9d261-s> </span><span class="ct-64dd25" data-v-5db9d261-s>void</span></div><div class="line" data-v-5db9d261-s><span class="ct-bd97d6" data-v-5db9d261-s>     */</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>    </span><span class="ct-64dd25" data-v-5db9d261-s>private</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-64dd25" data-v-5db9d261-s>static</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-64dd25" data-v-5db9d261-s>function</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-1a0873" data-v-5db9d261-s>deriveKeyAndIv</span><span class="ct-dfecf0" data-v-5db9d261-s>($passphrase, $salt, $keySize </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>8</span><span class="ct-dfecf0" data-v-5db9d261-s>, $ivSize </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>4</span><span class="ct-dfecf0" data-v-5db9d261-s>, $iterations </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>1</span><span class="ct-dfecf0" data-v-5db9d261-s>, $hashAlgorithm </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-166a79" data-v-5db9d261-s>&quot;md5&quot;</span><span class="ct-dfecf0" data-v-5db9d261-s>)</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>    {</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>        $targetKeySize </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> $keySize </span><span class="ct-64dd25" data-v-5db9d261-s>+</span><span class="ct-dfecf0" data-v-5db9d261-s> $ivSize;</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>        $derivedBytes </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-166a79" data-v-5db9d261-s>&quot;&quot;</span><span class="ct-dfecf0" data-v-5db9d261-s>;</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>        $numberOfDerivedWords </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>0</span><span class="ct-dfecf0" data-v-5db9d261-s>;</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>        $block </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>NULL</span><span class="ct-dfecf0" data-v-5db9d261-s>;</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>        $hasher </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>hash_init</span><span class="ct-dfecf0" data-v-5db9d261-s>($hashAlgorithm);</span></div><div class="line" data-v-5db9d261-s></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>        </span><span class="ct-64dd25" data-v-5db9d261-s>while</span><span class="ct-dfecf0" data-v-5db9d261-s> ($numberOfDerivedWords </span><span class="ct-64dd25" data-v-5db9d261-s>&lt;</span><span class="ct-dfecf0" data-v-5db9d261-s> $targetKeySize) {</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            </span><span class="ct-64dd25" data-v-5db9d261-s>if</span><span class="ct-dfecf0" data-v-5db9d261-s> ($block </span><span class="ct-64dd25" data-v-5db9d261-s>!=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>NULL</span><span class="ct-dfecf0" data-v-5db9d261-s>) {</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>                </span><span class="ct-dd1cad" data-v-5db9d261-s>hash_update</span><span class="ct-dfecf0" data-v-5db9d261-s>($hasher, $block);</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            }</span></div><div class="line" data-v-5db9d261-s></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            </span><span class="ct-dd1cad" data-v-5db9d261-s>hash_update</span><span class="ct-dfecf0" data-v-5db9d261-s>($hasher, $passphrase);</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            </span><span class="ct-dd1cad" data-v-5db9d261-s>hash_update</span><span class="ct-dfecf0" data-v-5db9d261-s>($hasher, $salt);</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            $block </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>hash_final</span><span class="ct-dfecf0" data-v-5db9d261-s>($hasher, </span><span class="ct-dd1cad" data-v-5db9d261-s>TRUE</span><span class="ct-dfecf0" data-v-5db9d261-s>);</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            $hasher </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>hash_init</span><span class="ct-dfecf0" data-v-5db9d261-s>($hashAlgorithm);</span></div><div class="line" data-v-5db9d261-s></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            </span><span class="ct-bd97d6" data-v-5db9d261-s>// Iterations</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            </span><span class="ct-64dd25" data-v-5db9d261-s>for</span><span class="ct-dfecf0" data-v-5db9d261-s> ($i </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>1</span><span class="ct-dfecf0" data-v-5db9d261-s>; $i </span><span class="ct-64dd25" data-v-5db9d261-s>&lt;</span><span class="ct-dfecf0" data-v-5db9d261-s> $iterations; $i</span><span class="ct-64dd25" data-v-5db9d261-s>++</span><span class="ct-dfecf0" data-v-5db9d261-s>) {</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>                </span><span class="ct-dd1cad" data-v-5db9d261-s>hash_update</span><span class="ct-dfecf0" data-v-5db9d261-s>($hasher, $block);</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>                $block </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>hash_final</span><span class="ct-dfecf0" data-v-5db9d261-s>($hasher, </span><span class="ct-dd1cad" data-v-5db9d261-s>TRUE</span><span class="ct-dfecf0" data-v-5db9d261-s>);</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>                $hasher </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>hash_init</span><span class="ct-dfecf0" data-v-5db9d261-s>($hashAlgorithm);</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            }</span></div><div class="line" data-v-5db9d261-s></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            $derivedBytes </span><span class="ct-64dd25" data-v-5db9d261-s>.=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>substr</span><span class="ct-dfecf0" data-v-5db9d261-s>($block, </span><span class="ct-dd1cad" data-v-5db9d261-s>0</span><span class="ct-dfecf0" data-v-5db9d261-s>, </span><span class="ct-dd1cad" data-v-5db9d261-s>min</span><span class="ct-dfecf0" data-v-5db9d261-s>(</span><span class="ct-dd1cad" data-v-5db9d261-s>strlen</span><span class="ct-dfecf0" data-v-5db9d261-s>($block), ($targetKeySize </span><span class="ct-64dd25" data-v-5db9d261-s>-</span><span class="ct-dfecf0" data-v-5db9d261-s> $numberOfDerivedWords) </span><span class="ct-64dd25" data-v-5db9d261-s>*</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>4</span><span class="ct-dfecf0" data-v-5db9d261-s>));</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            $numberOfDerivedWords </span><span class="ct-64dd25" data-v-5db9d261-s>+=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>strlen</span><span class="ct-dfecf0" data-v-5db9d261-s>($block) </span><span class="ct-64dd25" data-v-5db9d261-s>/</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>4</span><span class="ct-dfecf0" data-v-5db9d261-s>;</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>        }</span></div><div class="line" data-v-5db9d261-s></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>        </span><span class="ct-64dd25" data-v-5db9d261-s>return</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>array</span><span class="ct-dfecf0" data-v-5db9d261-s>(</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            </span><span class="ct-166a79" data-v-5db9d261-s>&quot;key&quot;</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-64dd25" data-v-5db9d261-s>=&gt;</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>substr</span><span class="ct-dfecf0" data-v-5db9d261-s>($derivedBytes, </span><span class="ct-dd1cad" data-v-5db9d261-s>0</span><span class="ct-dfecf0" data-v-5db9d261-s>, $keySize </span><span class="ct-64dd25" data-v-5db9d261-s>*</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>4</span><span class="ct-dfecf0" data-v-5db9d261-s>),</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>            </span><span class="ct-166a79" data-v-5db9d261-s>&quot;iv&quot;</span><span class="ct-dfecf0" data-v-5db9d261-s>  </span><span class="ct-64dd25" data-v-5db9d261-s>=&gt;</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>substr</span><span class="ct-dfecf0" data-v-5db9d261-s>($derivedBytes, $keySize </span><span class="ct-64dd25" data-v-5db9d261-s>*</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>4</span><span class="ct-dfecf0" data-v-5db9d261-s>, $ivSize </span><span class="ct-64dd25" data-v-5db9d261-s>*</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>4</span><span class="ct-dfecf0" data-v-5db9d261-s>)</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>        );</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>    }</span></div><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>}</span></div></code></pre><!--]--><div class="bottom-container opacity-100 group-hover:md:opacity-100 md:opacity-0 transition-opacity duration-150" data-v-5db9d261><div class="copy-container" data-v-5db9d261><button class="p-1 text-background border rounded-md border-background hover:border-brand_primary hover:bg-brand_primary hover:text-background" data-v-5db9d261><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="w-5 h-5" width="20" height="20" data-v-5db9d261><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button></div></div></div><p><!--[-->This class can be used to decrypt the SSO payload like this:<!--]--></p><div class="container group" data-v-5db9d261><!----><!----><!--[--><pre data-v-5db9d261-s><code data-v-5db9d261-s><div class="line" data-v-5db9d261-s><span class="ct-dfecf0" data-v-5db9d261-s>$data </span><span class="ct-64dd25" data-v-5db9d261-s>=</span><span class="ct-dfecf0" data-v-5db9d261-s> </span><span class="ct-dd1cad" data-v-5db9d261-s>CryptoJs</span><span class="ct-64dd25" data-v-5db9d261-s>::</span><span class="ct-1a0873" data-v-5db9d261-s>decrypt</span><span class="ct-dfecf0" data-v-5db9d261-s>($ssoPayload, $ssoPassphrase);</span></div></code></pre><!--]--><div class="bottom-container opacity-100 group-hover:md:opacity-100 md:opacity-0 transition-opacity duration-150" data-v-5db9d261><div class="copy-container" data-v-5db9d261><button class="p-1 text-background border rounded-md border-background hover:border-brand_primary hover:bg-brand_primary hover:text-background" data-v-5db9d261><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="w-5 h-5" width="20" height="20" data-v-5db9d261><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg></button></div></div></div><p><!--[-->Good luck on your implementation!<!--]--></p><style>.ct-166a79{color:#A5D6FF}
.ct-dd1cad{color:#79C0FF}
.ct-1a0873{color:#D2A8FF}
.ct-711a65{color:#FFA657}
.ct-dfecf0{color:#C9D1D9}
.ct-64dd25{color:#FF7B72}
.ct-bd97d6{color:#8B949E}</style></div></article><aside class="blog-aside col-span-full h-fit md:col-span-3" data-v-547b1330><div class="blog-aside-wrapper mb-4 !hidden md:!flex" data-v-547b1330><nav class="toc blog-post-text" data-v-547b1330 data-v-bd905aac><header class="flex cursor-pointer flex-row items-center justify-between mb-2" aria-label="Expand the table of contents." data-v-bd905aac><span class="blog-aside-title mb-0" data-v-bd905aac>Table of Contents</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="h-6 w-6 transform" width="24" height="24" data-v-bd905aac><path fill="currentColor" d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"></path></svg></header><ul class="block" data-v-bd905aac><!--[--><li class="toc-link_3 mt-2 first:mt-0 md:mt-1" data-v-bd905aac><a href="#the-challenge" class="hover:text-brand_primary hover:underline" data-v-bd905aac>The Challenge</a></li><li class="toc-link_3 mt-2 first:mt-0 md:mt-1" data-v-bd905aac><a href="#code" class="hover:text-brand_primary hover:underline" data-v-bd905aac>Code</a></li><!--]--></ul></nav></div><div class="blog-aside-wrapper" data-v-547b1330><div class="blog-post-text" data-v-547b1330><span class="blog-aside-title mb-2 block">Continue Reading</span><ul class="list-none"><!--[--><!--[--><li class="first:mt-0 mt-4 md:mt-1"><a href="/blog/high-level-sso-custom-links/" class="hover:underline hover:text-brand_primary" aria-label="HighLevel: Utilizing SSO sessions from inside Custom Menu Links">HighLevel: Utilizing SSO sessions from inside Custom Menu Links</a><p class="!no-underline md:hidden text-sm leading-sm md:text-xs md:leading-xs mt-1">You can use SSO sessions from inside Custom Menu Links, not just custom pages</p></li><!--]--><!--[--><li class="first:mt-0 mt-4 md:mt-1"><a href="/blog/2015-10-08-better-wordpress-cron-jobs-crontab-wpcli/" class="hover:underline hover:text-brand_primary" aria-label="Better Wordpress Cron Jobs with crontab and WP CLI">Better Wordpress Cron Jobs with crontab and WP CLI</a><p class="!no-underline md:hidden text-sm leading-sm md:text-xs md:leading-xs mt-1"></p></li><!--]--><!--]--></ul></div></div></aside><!--]--></section><div class="fixed flex flex-col items-center w-12 sm:w-section_x z-20 bottom-[50px] right-0 text-typography_primary bg-brand_primary/90 transform duration-150 rounded-tl-md rounded-bl-md translate-x-full" data-v-547b1330><a href="#" aria-label="Scroll to Top" class="flex flex-col items-center py-1 text-center"><span class="text-xxs leading-xxs uppercase font-highlight sm:w-6/12">Scroll to Top</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="w-4 h-4" width="16" height="16"><path fill="currentColor" d="M14,20H10V11L6.5,14.5L4.08,12.08L12,4.16L19.92,12.08L17.5,14.5L14,11V20Z"></path></svg></a></div><!--]--></main><!--]--></main></div><script type="module">import p from "/blog/high-level-decrypting-sso-sessions-with-php/_payload.js";window.__NUXT__={...p,...((function(a,b){return {state:{},_errors:{},serverRendered:true,config:{public:{content:{locales:[],defaultLocale:a,integrity:1700671510886,experimental:{stripQueryParameters:b,clientDB:b},api:{baseURL:"\u002Fapi\u002F_content"},navigation:{fields:[]},tags:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"prose-code",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},highlight:{theme:"github-dark",preload:["java","javascript"]},wsUrl:a,documentDriven:b,host:a,trailingSlash:b,anchorLinks:{depth:4,exclude:[1]}}},app:{baseURL:"\u002F",buildAssetsDir:"_nuxt",cdnURL:a}},prerenderedAt:1700671516698}}("",false)))}</script><script type="module" src="/_nuxt/entry.acb1fcef.js" crossorigin></script><script type="module" src="/_nuxt/_...slug_.26ea9c26.js" crossorigin></script><script type="module" src="/_nuxt/ContentDoc.4cbd78d1.js" crossorigin></script><script type="module" src="/_nuxt/ContentQuery.4cf8ba0c.js" crossorigin></script><script type="module" src="/_nuxt/ContentRenderer.e2709920.js" crossorigin></script><script type="module" src="/_nuxt/ContentRendererMarkdown.d2aa0a27.js" crossorigin></script><script type="module" src="/_nuxt/ProseP.f76cc4e6.js" crossorigin></script><script type="module" src="/_nuxt/ProseA.58a0bca4.js" crossorigin></script><script type="module" src="/_nuxt/ProseH3.e3bda208.js" crossorigin></script><script type="module" src="/_nuxt/ProseBlockquote.eea7abf6.js" crossorigin></script><script type="module" src="/_nuxt/ProseUl.43d61ab5.js" crossorigin></script><script type="module" src="/_nuxt/ProseLi.d5736ac6.js" crossorigin></script><script type="module" src="/_nuxt/ProseCodeInline.e4026ae0.js" crossorigin></script><script type="module" src="/_nuxt/ProseCode.2b2b0fd6.js" crossorigin></script></body>
</html>